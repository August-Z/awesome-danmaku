/*!
 * awesome-danmaku v1.0.0
 * (c) 2018 August-Z
 * https://github.com/August-Z/awesome-danmaku
 */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}("undefined"!=typeof self?self:this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=3)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(6);Object.keys(r).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return r[t]}})});var o=n(7);Object.keys(o).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return o[t]}})})},function(t,e,n){"use strict";function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function o(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.DanmakuPlayer=void 0;var a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(2),l=n(4),c=n(5),f=n(0),h=r(f),y=n(9),p=r(y);e.DanmakuPlayer=function(){function t(e){if(i(this,t),!window)throw new Error("请在浏览器环境下运行");this.playStatus=f.DanmakuControlPlayStatus.EMPTY,(0,l.initMergeDefaultParams)(e,{wrap:document.body,rollingTime:6e3,nodeTag:"div",nodeClass:"",nodeValueKey:"value",trackCount:5,trackHeight:40,on:{}},this),e.hasOwnProperty("list")&&this.insertDanmaku(e.list),this.list=[],this.trackList=[],this._init()}return u(t,[{key:"insertDanmaku",value:function(t){var e;(e=this.list).push.apply(e,o(this._handleDanmakuOps(t).map(function(t){return new c.Dnode(t)})))}},{key:"play",value:function(){var t=this;if(!Array.isArray(this.list))throw new TypeError("list must instanceof Array");return this.playTimer=setInterval(function(){if(t.list.length&&t.trackList.some(function(t){return t.unObstructed})){var e=t.list.shift();e&&e.run().then(function(t){t.removeDnode()})}},200),this.playStatus=f.DanmakuControlPlayStatus.PLAY,this._controlHook(f.DanmakuControlEventName.PLAY),this}},{key:"pause",value:function(){return clearInterval(this.playTimer),this.playStatus=f.DanmakuControlPlayStatus.PAUSED,this._controlHook(f.DanmakuControlEventName.PAUSE),this}},{key:"stop",value:function(){return clearInterval(this.playTimer),this.clearList(),this.playStatus=f.DanmakuControlPlayStatus.STOP,this._controlHook(f.DanmakuControlEventName.STOP),this}},{key:"clearList",value:function(){return this.list=[],this}},{key:"getUnObstructedTrack",value:function(t){var e=this.trackList.filter(function(t){return t.unObstructed});return e["number"==typeof t?t:Math.floor(Math.random()*e.length)]}},{key:"_init",value:function(){return this._bindControlStyle(),this._initTrackList(),this.playStatus=f.DanmakuControlPlayStatus.INIT,this._controlHook(f.DanmakuControlEventName.INIT),this}},{key:"_bindControlStyle",value:function(){return this.wrap.style.position="relative",this.wrap.style.overflow="hidden",this.wrap.style.cursor="none",this.wrap.style.pointerEvents="none",this.wrap.style.verticalAlign="baseline",this}},{key:"_initTrackList",value:function(){for(var t=0;t<this.trackCount;t++)this.trackList.push(new s.Dtrack({index:t,width:this.playerWidth,height:this.trackHeight}));return this}},{key:"_handleDanmakuOps",value:function(t){var e=this,n=[];return Array.isArray(t)||"[object Array]"===Object.prototype.toString.call(t)?n.push.apply(n,o(t.map(function(t){return e._transformDnodeOps(t)}))):n.push(this._transformDnodeOps(t)),n}},{key:"_transformDnodeOps",value:function(t){if("string"==typeof t)return a({control:this,text:t},h.DnodeDefaultConfig.getDefault);if(t instanceof Object)return(0,l.initMergeDefaultParams)(t,a({control:this,text:t.hasOwnProperty(this.nodeValueKey)?t[this.nodeValueKey]:""},h.DnodeDefaultConfig.getDefault));throw new TypeError("Bad param!")}},{key:"_controlHook",value:function(t){var e=this;this.on.hasOwnProperty(t)&&"function"==typeof this.on[t]&&p.controlEmitter.hook(f.DanmakuControlEventName.INIT,function(){e.on[t](e)})}},{key:"playerWidth",get:function(){return this.wrap.clientWidth||0}}],[{key:"getInstanceControl",value:function(e){return t.instanceControl||(t.instanceControl=new t(e)),t.instanceControl}}]),t}()},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=e.Dtrack=function(){function t(e){r(this,t),this.status=t.UN_ROLLING,this.index=e.index,this.height=e.height,this.offsetTop=e.height*e.index}return o(t,[{key:"rolling",value:function(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;setTimeout(function(){n.status=t.ROLLING,"function"==typeof e&&e(n)},r)}},{key:"stopRolling",value:function(){this.status=t.UN_ROLLING}},{key:"getTopByMiddleDnode",value:function(t){return this.offsetTop+(this.height-t)/2}},{key:"obstructed",get:function(){return this.status===t.ROLLING}},{key:"unObstructed",get:function(){return this.status===t.UN_ROLLING}}]),t}();i.ROLLING=1,i.UN_ROLLING=0},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1);t.exports={DanmakuPlayer:r.DanmakuPlayer},e.default={DanmakuPlayer:r.DanmakuPlayer},window&&(window.AwesomeDanmaku={DanmakuPlayer:r.DanmakuPlayer})},function(t,e,n){"use strict";function r(t,e,n){if(!(t instanceof Object&&e instanceof Object))throw new TypeError("params must instanceof Object !");Object.entries(t).forEach(function(t){var n=a(t,2),r=n[0],o=n[1];e.hasOwnProperty(r)&&(e[r]=o)});var r=Object.entries(e);return n&&n instanceof Object?o(n,r):i(r)}function o(t,e){return e.forEach(function(e){var n=a(e,2),r=n[0],o=n[1];t[r]=o}),t}function i(t){var e={};return t.forEach(function(t){var n=a(t,2),r=n[0],o=n[1];e[r]=o}),e}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();e.initMergeDefaultParams=r},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Dnode=void 0;var o=function(){function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(0),u=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),s=n(8),l=(n(2),n(1));e.Dnode=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.DanmakuPlayer.getInstanceControl();if(r(this,t),"string"==typeof e)this.text=e,this.control=n;else{if(!(e instanceof Object))throw new Error("Dnode ops bad !");this.text=e.text,this.control=e.control,this.fontSize=e.fontSize,this.fontFamily=e.fontFamily,this.color=e.color,this.speed=e.speed}this._init()}return i(t,[{key:"run",value:function(){var t=this;return new Promise(function(e,n){t._joinTrack()._patch()._render();try{t.track.rolling(function(n){t.dom.style.transform="translate3d("+t.translateX+"px, 0, 0)",setTimeout(function(){n.stopRolling()},t.launchTime),setTimeout(function(){t.remove(),e(t)},t.control.rollingTime)})}catch(t){n(t)}})}},{key:"remove",value:function(){if(!(this.dom instanceof HTMLElement&&this.control.wrap instanceof HTMLElement))throw new TypeError("Control Dom or Node Dom not HTMLElement !");if(this.dom.parentElement!==this.control.wrap)throw new Error("Control Dom not is node dom parent，Can't remove node！");return this.control.wrap.removeChild(this.dom),this}},{key:"removeDnode",value:function(){}},{key:"_init",value:function(){return this._computedTextSize(),this._computedTotalDistance(),this}},{key:"_computedTextSize",value:function(){var e=(0,s.translateTextToSize)(this.text,t.getInstanceTemplateDom({fontSize:this.fontSize+"px",fontFamily:this.fontFamily})),n=e.width,r=e.height;this.width=n,this.height=r}},{key:"_computedTotalDistance",value:function(){var t=this.control.playerWidth+this.width;this.translateX=-1*t,this.launchTime=Math.round(this.control.rollingTime*(this.width/t))}},{key:"_joinTrack",value:function(){return this.track=this.control.getUnObstructedTrack(),this}},{key:"_patch",value:function(){var t=document.createElement(this.control.nodeTag);t.className=this.control.nodeClass,t.innerText=this.text;var e={display:"inline-block",width:this.width+"px",height:this.height+"px",lineHeight:"1.125",fontSize:this.fontSize+"px",fontFamily:this.fontFamily,color:this.color,top:this.track.getTopByMiddleDnode(this.height)+"px",left:this.control.playerWidth+"px",opacity:"1",transform:"translate3d(0, 0, 0)",transition:"transform "+Math.round(this.control.rollingTime/this.speed)+"ms linear 0s",position:"absolute",userSelect:"none",whiteSpace:"pre",perspective:"500px",cursor:"none",pointerEvents:"none"},n=t.style;return Object.entries(e).forEach(function(t){var e=o(t,2),r=e[0],i=e[1];n[r]=i}),this.dom=t,this}},{key:"_render",value:function(t){if(this.dom instanceof HTMLElement)return t?t.appendChild(this.dom):this.control.wrap.appendChild(this.dom),this;throw new Error("Dnode needs HTMLElement to render function !")}}],[{key:"getInstanceTemplateDom",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{fontSize:u.DnodeDefaultConfig.FONT_SIZE+"px",fontFamily:u.DnodeDefaultConfig.FONT_FAMILY};if(t.instanceTextSizeDom)t.instanceTextSizeDom.style.fontSize=e.fontSize,t.instanceTextSizeDom.style.fontFamily=e.fontFamily;else{var n=document.createElement("span");if(n.style.position="absolute",n.style.visibility="hidden",n.style.display="inline-block",n.style.fontSize=e.fontSize,n.style.fontFamily=e.fontFamily,!document.body)throw new Error("Template DOM Error: document.body missing !!");document.body.appendChild(n),t.instanceTextSizeDom=n}return t.instanceTextSizeDom}}]),t}()},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=e.DnodeDefaultConfig=function(){function t(){r(this,t)}return o(t,null,[{key:"getDefault",get:function(){return{fontSize:t.FONT_SIZE,fontFamily:t.FONT_FAMILY,color:t.COLOR,speed:t.SPEED}}}]),t}();i.FONT_SIZE=22,i.FONT_FAMILY="SimHei",i.COLOR="#FFFFFF",i.SPEED=1},function(t,e,n){"use strict";function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=e.DanmakuControlConfig=function t(){i(this,t)},u=e.DanmakuControlPlayStatus=function(t){function e(){return i(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),e}(a);u.EMPTY=-1,u.INIT=100,u.STOP=110,u.PLAY=200,u.PAUSED=210;e.DanmakuControlEventName={INIT:"init",PLAY:"play",PAUSE:"pause",STOP:"stop"}},function(t,e,n){"use strict";function r(t,e){return e.textContent=t,{width:parseFloat(window.getComputedStyle(e).width),height:parseFloat(window.getComputedStyle(e).height)}}Object.defineProperty(e,"__esModule",{value:!0}),e.translateTextToSize=r},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.controlEmitter=void 0;var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(0),s=n(10),l=function(t){function e(t){r(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return console.log(n),n}return i(e,t),a(e,[{key:"hook",value:function(t,e){if(this.hooks.has(t))return void e();throw new Error("[Event Error]: Hook error, Not has "+t+" event !")}}]),e}(s.DanmakuEvent);e.controlEmitter=new l(u.DanmakuControlEventName)},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(e){var n=this;r(this,t),this.hooks=new Set,Object.entries(e).forEach(function(t){var e=o(t,2),r=(e[0],e[1]);n.hooks.add(r)})}return i(t,[{key:"hook",value:function(t,e){}}]),t}();e.DanmakuEvent=a}])});